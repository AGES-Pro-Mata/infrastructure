#!/bin/bash

# quick-start.sh - Inicializa√ß√£o r√°pida do sistema de seguran√ßa Pro-Mata

set -euo pipefail

SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
PROJECT_ROOT="$(cd "$SCRIPT_DIR/../.." && pwd)"  # Go up two levels: scripts/utils -> scripts -> root

echo "üöÄ Pro-Mata Security - Quick Start"
echo "=================================="
echo ""

# Verificar se j√° est√° inicializado
if [[ ! -f "$PROJECT_ROOT/security/security-config.yml" ]]; then
    echo "‚ùå Sistema n√£o inicializado. Execute primeiro:"
    echo "   make security-init"
    exit 1
fi

echo "‚úÖ Sistema inicializado"

# Menu de op√ß√µes
echo ""
echo "Selecione uma op√ß√£o:"
echo "1) Iniciar monitoramento"
echo "2) Executar scan de seguran√ßa"
echo "3) Verificar status"
echo "4) Abrir dashboard"
echo "5) Executar auditoria"
echo "0) Sair"
echo ""

read -p "Op√ß√£o: " option

case "$option" in
    1)
        echo "üîç Iniciando monitoramento..."
        "$SCRIPT_DIR/security-monitor.sh" --environment dev &
        echo "Monitor iniciado em background"
        ;;
    2)
        echo "üîç Executando scan..."
        "$SCRIPT_DIR/security-scan.sh" --environment dev
        ;;
    3)
        echo "üìä Verificando status..."
        make security-status
        ;;
    4)
        echo "üìà Abrindo dashboard..."
        if command -v xdg-open &> /dev/null; then
            xdg-open "file://$PROJECT_ROOT/dashboard.html"
        else
            echo "Abra manualmente: $PROJECT_ROOT/dashboard.html"
        fi
        ;;
    5)
        echo "üîç Executando auditoria..."
        "$PROJECT_ROOT/scripts/security/security-audit.sh" --compliance-check --environment dev
        ;;
    0)
        echo "üëã At√© logo!"
        ;;
    *)
        echo "‚ùå Op√ß√£o inv√°lida"
        ;;
esac
