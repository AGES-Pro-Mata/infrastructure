#!/bin/bash

# Terraform Variable Setup Script for Pro-Mata Infrastructure
echo "üîß Pro-Mata Terraform Variable Setup"
echo "===================================="

# Check current directory
if [[ ! -f "variables.tf" ]]; then
    echo "‚ùå Error: Run this script from terraform/deployments/dev directory"
    echo "   Current directory: $(pwd)"
    echo "   Expected files: variables.tf, main.tf"
    exit 1
fi

echo "üìã Setting up terraform.tfvars file..."

# Copy example file
if [[ -f "terraform.tfvars.example" ]]; then
    cp terraform.tfvars.example terraform.tfvars
    echo "‚úÖ Created terraform.tfvars from example"
else
    echo "‚ùå terraform.tfvars.example not found"
    exit 1
fi

echo ""
echo "‚ö†Ô∏è  IMPORTANT: You need to configure Cloudflare credentials!"
echo ""
echo "1. Get your Cloudflare API Token:"
echo "   - Go to https://dash.cloudflare.com/profile/api-tokens"
echo "   - Click 'Create Token'"
echo "   - Use 'Edit zone DNS' template"
echo "   - Include Zone: promata.com.br"
echo ""
echo "2. Get your Cloudflare Zone ID:"
echo "   - Go to https://dash.cloudflare.com"
echo "   - Select promata.com.br domain"
echo "   - Copy Zone ID from the right sidebar"
echo ""
echo "3. Edit terraform.tfvars and replace:"
echo "   cloudflare_api_token = \"YOUR_CLOUDFLARE_API_TOKEN_HERE\""
echo "   cloudflare_zone_id = \"YOUR_CLOUDFLARE_ZONE_ID_HERE\""
echo ""
echo "4. Then run:"
echo "   terraform plan"
echo "   terraform apply"

echo ""
echo "üéØ Current Issues Fixed:"
echo "‚úÖ Project name: myproject ‚Üí pro-mata"
echo "‚úÖ Resource group: rg-myproject-dev ‚Üí rg-pro-mata-dev"
echo "‚úÖ Storage account: myprojectdevstore ‚Üí promatadevstg"
echo "‚úÖ Domain: dev.example.com ‚Üí promata.com.br"
echo "‚úÖ Docker images: Updated to norohim/pro-mata-*"

echo ""
echo "üîÑ This will prevent infrastructure recreation"
echo "   Only DNS records will be added/updated"
